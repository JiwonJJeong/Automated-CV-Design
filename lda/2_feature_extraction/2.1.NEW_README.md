Reference 2.1.README.md for original details.

This modification does the same thing, but converted into reusuable python scripts.

Assumption: Time x Pairwise distance matrix calculation outputs are already computed.

File structure:

 base_directory_of_analysis/
    ├── construct1/
    │   ├── subconstruct1/
    │   │   ├── 1_s0001_e0150_pairwise_dist.npy
    │   │   ├── 1_s0151_e0300_pairwise_dist.npy
    │   │   └── 2_s0001_e0150_pairwise_dist.npy
    │   ├── subconstruct2/
    │   └── subconstruct3/
    └── construct2/
        ├── subconstruct1/
        ├── subconstruct2/
        └── subconstruct3/


# Contact Map Output Format

This document describes the data structure of the output files generated by `contact_map.py`.

## File Specifications
- **Format:** NumPy Binary File (`.npy`)
- **Storage Method:** Memory-mapped (`np.lib.format.open_memmap`) for efficient disk-to-RAM streaming.
- **Data Type:** `float32`
- **Shape:** `(n_frames, 11175)`

## Structure Dimensions

### 1. Time (Axis 0: `n_frames`)
The first dimension represents the temporal sequence of the trajectory.
- Each index `i` corresponds to a single snapshot (frame) from the source MD trajectory.
- Frame indexing is continuous across all input `.nc` files provided to the script.

### 2. Distances (Axis 1: `11175` elements)
The second dimension contains the **condensed upper triangle** of a symmetric **150x150 distance matrix**.
- **150 Residues:** The script projects all proteins onto a canonical 150-residue template defined in `system_utils.py`.
- **Upper Triangle:** To save space, only the distances between unique pairs of residues $(i, j)$ where $i < j$ are stored.
- **Size Calculation:** $N(N-1)/2 \rightarrow 150(149)/2 = 11,175$.

## Canonical Mapping
Individual residues from the simulation are mapped to specific slots in the 150-residue matrix:
- **Calmodulin (146 res):** Mapped to slots representing the core structure, with specific offsets for loop regions.
- **Calmodulin-Compact (150 res):** Mapped 1-to-1 to slots 0-149.
- **Missing Residues:** If a construct has fewer than 150 residues, the "missing" residue slots in the matrix are filled with `0.0`.

## How to Reconstruct and Analyze
To restore the full pairwise distance matrix for a specific frame, use the `squareform` function from `scipy`:

```python
import numpy as np
from scipy.spatial.distance import squareform

# Load the memory-mapped data
data = np.load("contact_map_output.npy", mmap_mode='r')

# Reconstruct frame 100 into a 150x150 matrix
frame_idx = 100
dist_matrix_150x150 = squareform(data[frame_idx])

# Access distance between Canonical Residue 10 and Canonical Residue 50
distance = dist_matrix_150x150[9, 49]
```
